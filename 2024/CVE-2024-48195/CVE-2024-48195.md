eyouCMS v1.6.7



Types of vulnerabilities: Storage XSS



vulnerabilities details:

There is a storage XSS vulnerability in the backend column management area.



vulnerabilities details:

![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726102979192-47127d3e-ef4b-4900-9bc3-ac5d129662d6.png)

Create a new column.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1729911613676-5c6cdd13-4423-47ca-ac50-f4516d444787.png)

Add an 'h' tag to the column name and directory name respectively.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726103133329-11d90057-28fe-424b-8617-8da8ee9e5a43.png)

No 'h' tag was found to be parsed.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726103177878-91f5c1dd-032e-4cdf-8121-b98289941fd1.png)

but the 'h' tag on the homepage has been parsed.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1729911845570-57cad232-b893-4d82-9161-dc4b503bad5d.png)

Replace the 'h' tag with a pop-up function.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726103278600-2591ee45-6d3d-4344-bd9c-72251c1bf907.png)

After confirming the submission, the page will automatically redirect. When loading the column, the JavaScript code was parsed and the alert function was executed.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726103344762-29ba5028-f0e9-4415-bd6a-3e6f9e5267a3.png)

Pop ups have also appeared on the homepage.



The relevant code for adding columns can be found in the application/admin/controller/Archtype.php file.

![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726106768317-6689387d-c595-46fb-bc27-58e2de61ca03.png)

HTML entity encoding was applied to the column name typename on line 193.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726106969239-170909c9-541c-4c07-9755-58d50a27762a.png)

You may think there won't be XSS vulnerabilities here, but things always come as a surprise.



But when reading the database content, the column name typename was decoded as an HTML entity.

![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726107189771-b1c69b81-bdf9-49d5-a291-964a580cfd2d.png)

We used the htmlspecialchars_decode() HTML entity decoding function in the GetAllArctype function of application/common/logic/NavigationLogic.php.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726217002947-89396601-7936-4541-9fa0-0dc8891afbfb.png)

The value of the $yiv variable comes from the $oneLevel variable.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726217100572-df97c022-d15a-4ccd-b0ca-25c07c7b2703.png)

The value of the $oneLevel variable comes from the result of querying the arctype table in the $ArcTypeData database.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726107259883-c8c66c4e-804f-46a6-8d00-6ba35ae032f9.png)

The HTML entity decoding function is also used in the index () function of application/admin/controller/Archives. php.



![](https://cdn.nlark.com/yuque/0/2024/png/12420811/1726107364416-5d9a5c5b-2b27-4385-94d3-5293e9000e7b.png)

The reason for this vulnerability is that the developer improperly used HTML entity encoding functions and HTML entity decoding functions.

