# -*- coding: utf-8 -*-
#https://github.com/Jenderal92/CVE-2024-10508/
import requests
from multiprocessing.dummy import Pool as ThreadPool
import sys
import re

print("""
=======================================
   Scanner CVE-2024-10508
   WordPress Plugin: RegistrationMagic
=======================================
""")

file_path = raw_input("Enter the path to the file containing URLs: ")

try:
    with open(file_path, 'r') as file:
        urls = [line.strip() for line in file if line.strip()]
except IOError:
    print("Error: Could not read file. Please check the file path.")
    sys.exit()

headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (like Gecko) Chrome/130.0.6723.70 Safari/537.36",
}

def scan_site(url):
    try:
        response = requests.get(url + '/wp-content/plugins/custom-registration-form-builder-with-submission-manager/readme.txt', headers=headers)
        if response.status_code == 200:
            if "Stable tag: 6.0.2.6" in response.text:
                print("Vulnerable: " + url)
                with open('vuln.txt', 'a') as vuln_file:
                    vuln_file.write(url + '\n')
            else:
                print("Not vulnerable: " + url)
        else:
            print("Failed to access " + url + " Status code: " + str(response.status_code))
    except requests.RequestException as e:
        print("Failed to connect to " + url + " Error: " + str(e))

num_threads = 5
pool = ThreadPool(num_threads)
pool.map(scan_site, urls)
pool.close()
pool.join()
