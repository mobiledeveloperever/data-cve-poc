id: CVE-2021-21972

info:
  name: VMware vSphere Client (HTML5) - Remote Code Execution
  author: dwisiswant0
  severity: critical
  verified: false
  description: |-
    默认启用的 vROps 插件（com.vmware.vropspluginui.mvc）ServicesController 类的 uploadova 接口存在未授权访问，可利用路径穿越将文件解压至特定目录实现 getshell。
    FOFA: app="vmware-vCenter"
  affected: |-
    7.0 <= vCenter Server < 7.0 U1c
    6.7 <= vCenter Server < 6.7 U3l
    6.5 1e <= vCenter Server < 6.5 U3n
    4.x <= Cloud Foundation (vCenter Server) < 4.2
    3.x <= Cloud Foundation (vCenter Server) < 3.10.1.2
  reference:
    - https://www.geekby.site/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/#23-cve-2021-21972
    - https://mp.weixin.qq.com/s?__biz=MzkzODQzNTU2NA==&mid=2247484562&idx=1&sn=b0279899de3fdefb3bc8c9d054237628
    - https://github.com/horizon3ai/CVE-2021-21972
  tags: vmware,vcenter,rce,cve,cve2021
  created: 2024/01/05

rules:
  r0:
    request:
      method: GET
      path: /ui/vropspluginui/rest/services/getstatus
    expression: |
        response.status == 200 && response.raw_header.bcontains(b'VSPHERE-UI-JSESSIONID') && "(Install|Config) Final Progress".bmatches(response.body)
expression: r0() 
