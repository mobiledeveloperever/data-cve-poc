id: CVE-2021-22005

info:
  name: VMware vCenter Server - Arbitrary File Upload
  author: PR3R00T
  severity: critical
  verified: true
  description: |-
    VMware vCenter Server contains an arbitrary file upload vulnerability in the Analytics service. A malicious actor with network access to port 443 on vCenter Server may exploit this issue to execute code on vCenter Server by uploading a specially crafted file.
    Analytics 服务相关端点存在目录穿越写文件，可以直接上传 Webshell 文件，并获取 root 权限。
  affected: |
    Allows an attacker to upload and execute arbitrary files on the target system
  reference:
    - https://www.geekby.site/2022/05/vcenter%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/#25-cve-2021-22005
    - https://github.com/r0ckysec/CVE-2021-22005
    - https://github.com/shmilylty/cve-2021-22005-exp
    - https://kb.vmware.com/s/article/85717
    - https://www.vmware.com/security/advisories/VMSA-2021-0020.html
    - https://core.vmware.com/vmsa-2021-0020-questions-answers-faq
    - https://nvd.nist.gov/vuln/detail/CVE-2021-22005
  tags: cve,cve2021,vmware,vcenter,fileupload
  created: 2024/01/05

rules:
  r0:
    request:
      method: GET
      path: /
    expression: response.status == 200 && response.body.bcontains(b'VMware vSphere')
  r1:
    request:
      method: POST
      path: /analytics/telemetry/ph/api/hyper/send?_c&_i=test
      headers:
        Content-Type: application/json
      body: test_data
    expression: response.status == 201
expression: r0() && r1()